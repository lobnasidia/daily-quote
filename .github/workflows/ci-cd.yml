name: build-and-deploy

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: engineerd/setup-kind@v0.6.2
        with:
          version: "v0.24.0"
      - name: Build Docker image
        run: |
          docker build -t daily-quote-app:latest .
      - name: Deploy to Kubernetes
        run: |
          kubectl apply -f daily-quote.yml
      - name: Wait for pods to be running
        run: |
          kubectl wait --for=condition=Ready pods -l app=daily-quote --timeout=120s
      - name: Verify Deployment
        run: |
          kubectl get pods
          kubectl get svc
          kubectl get ingress
